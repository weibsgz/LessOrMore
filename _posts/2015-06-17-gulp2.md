---
layout: post
title:  browser-sync配合gulp使用
date:   2016-11-23 01:08:00 +0800
categories: 工具
tag: 工具
---

* content
{:toc}

使用browser-sync 来用作服务器，实现实时刷新

packge.json
====================================
{% highlight bash %}
{
  "name": "test",
  "version": "1.0.0",
  "description": "test",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "weibin",
  "license": "ISC",
  "devDependencies": {
    "browser-sync": "^2.17.3",
    "echarts": "^3.2.3",
    "gulp": "^3.9.1",
    "gulp-connect": "^5.0.0",
    "gulp-css-spriter": "^0.3.3",
    "gulp-cssmin": "^0.1.7",
    "gulp-file-include": "^1.0.0",
    "gulp-imagemin": "^2.2.1",
    "gulp-less": "^3.1.0",
    "gulp-notify": "^2.2.0",
    "gulp-plumber": "^1.1.0",
    "jquery": "^1.11.3"
  }
}
{% endhighlight %}



gulpfile.js
====================================
{% highlight bash %}
var gulp = require('gulp');
var browserSync = require('browser-sync');
var cssmin = require('gulp-cssmin');
var fileinclude = require('gulp-file-include');
var plumber = require('gulp-plumber');
var imagemin = require('gulp-imagemin');

var spriter = require('gulp-css-spriter');
var connect = require('gulp-connect'); //本地服务
//var less = require('gulp-less');
//var notify = require('gulp-notify');  //处理LESS错误

var reload = browserSync.reload;

var options = {};


gulp.task("css", function() {
    gulp.src("src/css/*.css")
     	.pipe(plumber())
        .pipe(gulp.dest("dist/css"))
        .pipe(reload({ stream: true }));
});
//打包JS到dist目录
gulp.task('jstodist', function() {
    gulp.src('src/js/*')
        .pipe(plumber())
        .pipe(gulp.dest('dist/js'))
        .pipe(reload({ stream: true }));
});


//用于在html文件中直接include文件
gulp.task('fileinclude', function(done) {
    gulp.src(['src/html/*.html'])
        .pipe(fileinclude({
            prefix: '@@',
            basepath: '@file'
        }))
        .pipe(gulp.dest('dist/html'))
        .on('end', done)
        .pipe(reload({ stream: true }))
});

// 压缩图片
gulp.task('imagemin', function(){
    return gulp.src('src/images/**')
        .pipe(plumber())
        .pipe(imagemin())
        .pipe(gulp.dest('dist/images/'))
});


// 监视文件改动并重新载入
gulp.task('serve', function() {
    browserSync({
        server: {
            baseDir: 'dist/'
        }
    });

    gulp.watch(['src/**/*.css'], ['css']);
    gulp.watch(['src/**/*.js'], ['jstodist']);
    gulp.watch(['src/html/**/*.html'], ['fileinclude']);
    gulp.watch(['src/images/*'], ['imagemin']);
});


gulp.task('default',['serve','jstodist','fileinclude','css','imagemin'])

{% endhighlight %}

运行完毕后 打开 localhost:3000/html